[pytest]
# =============================================================================
# Test Discovery and Paths
# =============================================================================
# testpaths: Directory containing test files
testpaths = tests

# pythonpath: Add project root to Python path for imports
pythonpath = .

# =============================================================================
# Test Markers
# =============================================================================
# Markers allow categorizing and selectively running tests
# Usage: pytest -m marker_name
markers =
    smoke: quick boot- and API-level checks
    local_heavy: full-stack tests requiring real Ollama and all services (local development only)
    websocket: WebSocket tests (may require async)
    e2e: End-to-end flow tests
    slow: Slow-running tests (>5s)
    admin: Admin control tests
    bulk: Bulk action tests
    unit: mark test as a unit test
    integration: mark test as an integration test
    live: mark test as requiring live services
    performance: mark test as a performance test
    ui: UI/browser tests requiring Playwright
    ui_slow: Slow UI tests (visual regression, full flows)

# =============================================================================
# Test Execution Options
# =============================================================================
# addopts: Default command-line options applied to all pytest runs
# --tb=short: Use short traceback format for failures (cleaner output)
# --asyncio-mode=auto: Automatically detect and run async tests
addopts = --tb=short --asyncio-mode=auto

# asyncio_mode: Configure how pytest handles async tests
# auto: Automatically detect async fixtures and tests
asyncio_mode = auto

# =============================================================================
# Warning Filters
# =============================================================================
# Suppress specific warnings to reduce noise in test output
filterwarnings =
    ignore::pytest.PytestUnraisableExceptionWarning
    ignore::DeprecationWarning:pkg_resources
    ignore::RuntimeWarning:asyncio

# =============================================================================
# Coverage Configuration
# =============================================================================
# Coverage requirements - enforced when running with --cov flag
# Run with: pytest --cov=. --cov-report=html
# Minimum coverage threshold: 70% (achievable and realistic)
# To enforce: pytest --cov=. --cov-fail-under=70
#
# Note: Coverage enforcement is optional. To enable it, add to addopts:
# addopts = --tb=short --asyncio-mode=auto --cov=. --cov-fail-under=70
#
# Recommended coverage targets:
# - Minimum: 70% (enforced threshold)
# - Target: 80%+ for new modules
# - Critical paths: 90%+ coverage
#
# Generate coverage reports:
# HTML report: pytest --cov=. --cov-report=html (view in htmlcov/index.html)
# Terminal report: pytest --cov=. --cov-report=term-missing
